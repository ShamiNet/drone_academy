# ملاحظات الإصدار (عربي)

التاريخ: 2025-11-09
الفرع: feat/pdf-work

## جديد
- إضافة زر "مشاركة النسخة الاحتياطية" في شاشة الإعدادات الإدارية.
- مشاركة النسخة مباشرة من الذاكرة عبر `XFile.fromData` لتفادي مشاكل المسارات الداخلية.
- شاشة تحكم التطبيق (App Control): تمكين/تعطيل التطبيق، وتحديد الحد الأدنى للإصدار (`forceUpdateVersion`)، وإدارة رابط التحديث (`updateUrl`) مع تخزينها في Firestore.

## تحسينات
- توسيع نوع MIME إلى `*/*` لزيادة توافق ورقة المشاركة على بعض أجهزة أندرويد.
- تحسين رسائل التنبيه أثناء التصدير/المشاركة، مع عرض سبب الفشل وتنفيذ حفظ بديل.
- اعتماد آليات الحفظ الحديثة (FileSaver/SAF) على أندرويد لتخزين النسخ الاحتياطية في مجلد "التنزيلات" العام.
- إزالة انتقالات 탭 مزعجة باستبدال TabBarView بـ IndexedStack لتحسين تجربة التنقل.
- تحسين تباين الألوان لشارات/وسوم المستخدمين المحظورين مع الاستفادة من ألوان الخطأ في الثيم.

## إصلاحات
- معالجة مشكلة "Permission denied" عند التصدير على أندرويد بإلغاء الاعتماد على أذونات التخزين القديمة والكتابة المباشرة.
- فصل منطق إنشاء بيانات النسخة الاحتياطية إلى `generateBackupBytes()` لإعادة الاستخدام (مشاركة/حفظ/رفع).
- إصلاح استخدام API في FileSaver (تصحيح أسماء الباراميترات والاعتماد على `name`, `bytes`, `mimeType`).

## وثائق وأمان
- إضافة مستند قواعد Firestore المقترحة لتقييد الكتابة على إعدادات التطبيق لمالكي النظام فقط.
- إضافة ملف أدوار وصلاحيات `ROLES_AND_PERMISSIONS.md` كمرجع تنظيمي.

## ملاحظات تشغيل
- بعد التصدير على أندرويد، ستجد الملف في "الملفات > التنزيلات" باسم:
  `drone_academy_backup_YYYY-MM-DD_HH-mm.json`
- المشاركة يمكن أن تفشل إذا لم يتوفر أي تطبيق يستقبل النوع المحدد؛ في هذه الحالة سيتم الحفظ تلقائياً.

## المهام المقترحة لاحقاً
- خيار ضغط النسخة الاحتياطية (ZIP) لتقليل الحجم وزيادة توافق المشاركة.
- إضافة مفاتيح l10n لسلاسل جديدة في شاشة الإعدادات الإدارية.
- توثيق آلية إسناد مطالبة المالك (Owner claim) لمطابقة قواعد Firestore.
